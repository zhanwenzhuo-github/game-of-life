FROM artistry.airwallex.com/repository/developers/java8:latest

MAINTAINER Airwallex

VOLUME /tmp
VOLUME /var/log/airwallex
VOLUME /etc/airwallex.conf

LABEL version=${APP_VERSION:-unknown}
LABEL info="Airwallex Pty Ltd"
LABEL description="The internal service endpoint"

COPY scripts/rest_entrypoint.sh /rest_entrypoint.sh

ADD build/libs/tranglo-integration*boot.jar        /app.jar

# Add Airwallex group and user
RUN groupadd -r airwallex --gid=888 \
    && useradd -r -g airwallex --uid=888 airwallex \
   && chmod +x /rest_entrypoint.sh

# External API
EXPOSE 11180


HEALTHCHECK --interval=5s --timeout=2s --start-period=10m --retries=3 \
    CMD wget -qO- http://localhost:11180/health | grep -i '"status"\s*:\s*"UP"' 2>/dev/null >/dev/null

ENTRYPOINT [ "/rest_entrypoint.sh" ]
